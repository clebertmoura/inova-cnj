<nb-card>
  <nb-card-body>
    <nb-tabset (changeTab)="carregarAba($event)">
      <nb-tab tabTitle="Visão Geral" >

        <nb-card [nbSpinner]="loadingVisaoGeral"
        nbSpinnerStatus="warning"
        nbSpinnerSize="giant"
        nbSpinnerMessage="">
          <nb-card-body>
            <div class="row">
              <div class="col-md-4 col-sm-12">
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Tipo de Justiça:</label>
                      <nb-select (selectedChange)="carregarTribunal($event)"
                        [(selected)]="tipoJustica"
                        class="position-select"
                        fullWidth
                      >
                        <nb-option *ngFor="let tipoJustica of tiposJustica" [value]="tipoJustica">{{
                          tipoJustica.descricao
                        }}</nb-option>
                      </nb-select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Tribunal:</label>
                      <nb-select (selectedChange)="carregarOrgaoJulgador($event)"
                        [(selected)]="tribunal"
                        class="position-select"
                        fullWidth
                      >
                      <nb-option *ngFor="let tribunal of tribunais" [value]="tribunal">{{
                        tribunal.descricao
                      }}</nb-option>
                      </nb-select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Orgão Julgador:</label>
                      <nb-select
                        [(selected)]="orgaoJulgador"
                        class="position-select"
                        fullWidth
                      >
                      <nb-option *ngFor="let orgaoJulgador of orgaosJulgadores" [value]="orgaoJulgador">{{
                        orgaoJulgador.descricao
                      }}</nb-option>
                      </nb-select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Natureza:</label>
                      <nb-select
                        [(selected)]="natureza"
                        class="position-select"
                        fullWidth
                      >
                        <nb-option *ngFor="let natureza of naturezas" [value]="natureza">{{
                          natureza.descricao
                        }}</nb-option>
                      </nb-select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Classe:</label>
                      <nb-select
                        [(selected)]="classe"
                        class="position-select"
                        fullWidth
                      >
                        <nb-option *ngFor="let classe of classes" [value]="classe">{{
                          classe.descricao
                        }}</nb-option>
                      </nb-select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6 col-sm-12 col-lg-6">
                    <div class="row">
                      <div class="col-sm-12">
                        <div class="form-group">
                          <button nbButton status="info" (click)="pesquisarAnalitcs()">Pesquisar</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
    
              <!-- calendario data inicial -->
              <div class="col-md-3 col-sm-12">
                <div class="calendar-container">
                  <label class="label">Período</label>
                  <nb-calendar-range [(range)]="rangeDatas" showWeekNumber></nb-calendar-range>
                </div>
              </div>
            
              <!-- nuvem de assuntos -->
            </div>       
          </nb-card-body>
        </nb-card>

        <nb-card hidden="true">
          <nb-card-body>
            <nb-actions size="medium" fullWidth>
              <nb-action>
                <nb-icon class="action-icon" icon="chevron-right"></nb-icon>
                <span>{{tipoJustica != null ? tipoJustica.descricao : ""}}</span>
              </nb-action>
              <nb-action>
                <nb-icon class="action-icon" icon="chevron-right"></nb-icon>
                <span>{{tribunal != null ? tribunal.descricao : ""}}</span>
              </nb-action>
              <nb-action>
                <nb-icon class="action-icon" icon="chevron-right"></nb-icon>
                <span>{{orgaoJulgador != null ? orgaoJulgador.descricao : ""}}</span>
              </nb-action>
              <nb-action>
                <nb-icon class="action-icon" icon="chevron-right"></nb-icon>
                <span>{{natureza != null ? natureza.descricao : ""}}</span>
              </nb-action>
              <nb-action>
                <nb-icon class="action-icon" icon="chevron-right"></nb-icon>
                <span>{{classe != null ? classe.descricao : ""}}</span>
              </nb-action>
            </nb-actions>
          </nb-card-body>
        </nb-card>
        
        <iframe 
            [src]="dashboardUrl"    
            frameborder="0" scrolling="no" width="100%" style="min-height: 1800px;"
            allowtransparency ></iframe>

      </nb-tab>

      <nb-tab tabTitle="Fluxo">

        <nb-card [nbSpinner]="loadingProcess"
          nbSpinnerStatus="warning"
          nbSpinnerSize="giant"
          nbSpinnerMessage="">
          <nb-card-body>
            <div class="row">
              <div class="col-md-4 col-sm-12">
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Tipo de Justiça:</label>
                      <nb-select
                        (selectedChange)="carregarTribunalProcess($event)"
                        [(selected)]="tipoJusticaProcess"
                        class="position-select"
                        fullWidth
                      >
                        <nb-option *ngFor="let tipoJusticaProcess of tiposJusticaProcess" [value]="tipoJusticaProcess">{{
                          tipoJusticaProcess.descricao
                        }}</nb-option>
                      </nb-select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Tribunal:</label>
                      <nb-select
                        (selectedChange)="carregarOrgaoJulgadorProcess($event)"
                        [(selected)]="tribunalProcess"
                        class="position-select"
                        fullWidth
                      >
                      <nb-option *ngFor="let tribunalProcess of tribunaisProcess" [value]="tribunalProcess">{{
                        tribunalProcess.descricao
                      }}</nb-option>
                      </nb-select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Orgão Julgador:</label>
                      <nb-select
                        [(selected)]="orgaoJulgadorProcess"
                        class="position-select"
                        fullWidth
                      >
                      <nb-option *ngFor="let orgaoJulgadorProcess of orgaosJulgadoresProcess" [value]="orgaoJulgadorProcess">{{
                        orgaoJulgadorProcess.descricao
                      }}</nb-option>
                      </nb-select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Natureza:</label>
                      <nb-select
                        [(selected)]="naturezaProcess"
                        class="position-select"
                        fullWidth
                      >
                        <nb-option *ngFor="let naturezaProcess of naturezasProcess" [value]="naturezaProcess">{{
                          naturezaProcess.descricao
                        }}</nb-option>
                      </nb-select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Classe:</label>
                      <nb-select
                        [(selected)]="classeProcess"
                        class="position-select"
                        fullWidth
                      >
                        <nb-option *ngFor="let classeProcess of classesProcess" [value]="classeProcess">{{
                          classeProcess.descricao
                        }}</nb-option>
                      </nb-select>
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="row">
                      <div class="col">
                        <button nbButton status="info" (click)="adicionarModeloPm()">Adicionar</button>
                      </div>
                      <div class="col">
                        <button nbButton status="info" (click)="limparModeloProcesso()">Limpar</button>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

            </div>
    
          </nb-card-body>
        </nb-card>

        <div class="row">
          <div *ngFor="let filtro of filtrosPm; let idx = index"
            [class]="filtro.maximized ? 'col-md-12 col-sm-12' : 'col-md-6 col-sm-12'">
            <nb-card [size]="filtro.maximized ? 'large' : 'medium'">
              <nb-card-header>
                <div class="row">
                  <div class="col-10 d-flex justify-content-start">
                    <nb-actions size="small" fullWidth>
                      <nb-action *ngIf="filtro.tribunal != null">
                        <nb-icon class="action-icon" icon="chevron-right"></nb-icon>
                        <span>{{filtro.tribunal.codigo}}</span>
                      </nb-action>
                      <nb-action *ngIf="filtro.natureza != null">
                        <nb-icon class="action-icon" icon="chevron-right"></nb-icon>
                        <span>{{filtro.natureza.descricao}}</span>
                      </nb-action>
                      <nb-action *ngIf="filtro.classe != null">
                        <nb-icon class="action-icon" icon="chevron-right"></nb-icon>
                        <span>{{filtro.classe.descricao}}</span>
                      </nb-action>
                    </nb-actions>
                  </div>
                  <div class="col-2 d-flex justify-content-end">
                    <nb-actions size="small" fullWidth>
                      <nb-action>
                        <nb-icon class="action-icon" icon="maximize" 
                          [icon]="filtro.maximized ? 'minimize' : 'maximize'"
                          (click)="maximizarModeloPm(filtro, idx)"></nb-icon>
                      </nb-action>
                      <nb-action>
                        <nb-icon class="action-icon" icon="close-circle-outline" (click)="removerModeloPm(filtro)"></nb-icon>
                      </nb-action>
                    </nb-actions>
                  </div>
                </div>
              </nb-card-header>
              <nb-card-body class="expandHeight">
                <div class="row expandHeight">
                  <div class="col d-flex justify-content-center modelosvg"
                    *ngIf="filtro.svgContent != null" 
                    [innerHTML]="filtro.svgContent" id="divModeloPm_{{idx}}">
                  </div>
                </div>
              </nb-card-body>
              <nb-card-footer>
                <div class="row">
                  <div class="col-md-6 col-sm-12 align-self-center">
                    <div class="row">
                      <div class="col-12">
                        Sensibilidade do modelo
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <mat-slider thumbLabel horizontal color="primary"
                        (change)="onChangeSensibilidade($event, filtro, idx)"
                        min="0" max="100" step="10" [(value)]="filtro.sensibilidade"></mat-slider>
                      </div>
                    </div>
                  </div>
                  <div class="col-md-6 col-sm-12">
                    <div class="row">
                      <div class="col-12" style="padding-bottom: 0.75em;">
                        Métrica
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-12">
                        <mat-radio-group aria-label="Selecione a metrica" [(ngModel)]="filtro.metrica"
                          color="primary"
                          (change)="onChangeMetrica($event, filtro, idx)">
                          <mat-radio-button *ngFor="let item of metricasPm" color="primary"
                            [value]="item">{{item == 'FREQUENCY' ? 'Frequência ' : 'Performance '}} <span>&nbsp;</span></mat-radio-button>
                        </mat-radio-group>
                      </div>
                    </div>
                  </div>
                </div>
              </nb-card-footer>
            </nb-card>
          </div>
        </div>
      </nb-tab>

      <nb-tab tabTitle="Previsões">
        
        <nb-card [nbSpinner]="loadingPredict"
        nbSpinnerStatus="warning"
        nbSpinnerSize="giant"
        nbSpinnerMessage="">
          <nb-card-body >
            <div class="row">
              <div class="col-md-3 col-sm-12">
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <input type="text" #npu fullWidth nbInput placeholder="NPU">
                    </div>
                  </div>
                </div>
              </div>
    
              <div class="col-md-3 col-sm-12">
                <div class="form-group">
                  <button nbButton status="info" (click)="pesquisarNpu(npu.value)">Pesquisar</button>
                </div>
              </div>
            </div>
          </nb-card-body>
        </nb-card>

        <nb-card #card [(hidden)]="!exibirResultadoNaoLocalizado">
          <nb-card-body >
            <div class="col-md-12">
              Processo não localizado
            </div>
          </nb-card-body>
        </nb-card>

        <nb-card #card [(hidden)]="!exibirResultadoPredict">
          <nb-card-body >
            <div class="col-md-12">
              <div class="row">
                <div class="col">
                  <div class="form-group">
                    <h4>Dados do Processo</h4>
                    <div class="row">
                      <div class="col-md-3">
                        <div class="summary-container">
                            <div><label class="label">Tribunal</label></div>
                            <div class="h6">{{ dadosProcessoSiglaTribunal }}</div>
                        </div>
                      </div>
                      <div class="col-md-9">
                        <div class="summary-container">
                              <div><label class="label">Orgão Julgador</label></div>
                              <div class="h6">{{ dadosProcessoOrgaoJulgador }}</div> 
                        </div>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-md-3">
                        <div class="summary-container">
                            <div><label class="label">Natureza</label></div>
                            <div class="h6">{{ dadosProcessoNatureza }}</div>
                        </div>
                      </div>
                      <div class="col">
                        <div class="summary-container">
                              <div><label class="label">Classe</label></div>
                              <div class="h6">{{ dadosProcessoClasse }}</div> 
                        </div>
                      </div>
                      <div class="col">
                        <div class="summary-container">
                              <div><label class="label">Assunto</label></div>
                              <div class="h6">{{ dadosProcessoAssunto }}</div> 
                        </div>
                      </div>
                    </div> 
                  </div>
                </div>
              </div>
            </div>
          
          <br>

            <div class="col-md-12">
              <!--Stepper-->
              <nb-stepper orientation="horizontal">
                <nb-step *ngFor="let historico of historicoFases; let i = index" 
                label="{{ historico.nome }} - {{ historico.situacao }}"> 
                  <p>Data Inicio: {{ historico.dataInicio }} </p>
                  <p>Data Conclusão: {{ historico.dataConclusao }} </p>
                </nb-step>
              </nb-stepper>
            </div>

            <div class="row">
              <div class="col-md-6 col-sm-12">
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <h4>Fases do Processo</h4>
                      <ng2-smart-table [settings]="configTabelaPredict" [source]="dadosTabelaPredict">
                      </ng2-smart-table>  
                    </div>
                  </div>
                </div>
              </div>
    
              <div class="col-md-6 col-sm-12">
                <div class="form-group">
                  <h4>Alertas</h4>
                  <nb-card class="list-card" size="small">
                    <nb-list>
                      <nb-list-item *ngFor="let dados of alertas">
                        <article>
                          <p>{{dados.nome}}</p>
                          <h6>{{dados.valor}}</h6>
                        </article>
                      </nb-list-item>
                    </nb-list>
                  </nb-card>
                </div>
              </div>
            </div>
            
          </nb-card-body>
        </nb-card>
        
      </nb-tab>

      <nb-tab tabTitle="Configurações">

        <nb-card [nbSpinner]="loadingConfig"
          nbSpinnerStatus="warning"
          nbSpinnerSize="giant"
          nbSpinnerMessage="">
          <nb-card-header>Cadastrar Fase</nb-card-header>
          <nb-card-body>
            <div class="row">
              <div class="col-md-3 col-sm-12">
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label for="inputDescricao" class="label">Descrição</label>
                      <input #fase type="text" nbInput fullWidth id="inputDescricao" [(ngModel)]="descricaoFase">  
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Tipo de Justiça:</label>
                      <nb-select
                        (selectedChange)="carregarTribunalConfig($event)"
                        [(selected)]="tipoJusticaConfig"
                        class="position-select"
                        fullWidth
                      >
                        <nb-option *ngFor="let tipoJusticaConfig of tiposJusticaConfig" [value]="tipoJusticaConfig">{{
                          tipoJusticaConfig.descricao
                        }}</nb-option>
                      </nb-select> 
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Tribunal:</label>
                      <nb-select
                        [(selected)]="tribunalConfig"
                        class="position-select"
                        fullWidth
                      >
                      <nb-option *ngFor="let tribunalConfig of tribunaisConfig" [value]="tribunalConfig">{{
                        tribunalConfig.descricao
                      }}</nb-option>
                      </nb-select>  
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-6 col-sm-12 col-lg-6">
                    <div class="row">
                      <div class="col-sm-12">
                        <div class="form-group">
                          <button nbButton status="info" (click)="onSaveConfirm($event)">Salvar</button>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
    
              <!-- calendario data inicial -->
              <div class="col-md-9 col-sm-12">
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <mat-form-field style="width:90% !important">
                        <mat-label>Selecione o Movimento</mat-label>
                        <input type="text" matInput [formControl]="myControl" [(value)]="pesquisaAutoComplete" [matAutocomplete]="auto">
                        <mat-autocomplete #auto="matAutocomplete" autoActiveFirstOption panelWidth="auto"
                          [displayWith]="displayFn" (optionSelected)='onOptionSelected($event)'>
                          <mat-option *ngFor="let option of filteredOptions | async" [value]="option">
                            {{option.codigo}} - {{option.descricao}}
                          </mat-option>
                        </mat-autocomplete>
                      </mat-form-field>
                    </div>  
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Lista de Movimentos</label>
                      <nb-card class="list-card" size="small">
                        <nb-card-body>
                          <div class="col-md-12 col-sm-12">
                            <div class="form-group">
                              <mat-action-list>
                                <mat-list-item *ngFor="let movimento of movimentos" [value]="movimento">
                                  <mat-icon mat-list-icon>
                                  <i class="nb-trash" (click)="onRemoverMovimentoLista($event, movimento)"></i>
                                  </mat-icon>
                                  <div mat-line>{{movimento.codigo}} - {{movimento.descricao}}</div>
                                  <div mat-line>código completo: {{movimento.codigoCompleto}}</div>
                                </mat-list-item>
                              </mat-action-list>
                            </div>
                          </div>
                        </nb-card-body>
                      </nb-card>
                    </div>  
                  </div>
                </div>
              </div>
            </div>       
          </nb-card-body>
        </nb-card>
        
        <nb-card [nbSpinner]="loadingConfig"
          nbSpinnerStatus="warning"
          nbSpinnerSize="giant"
          nbSpinnerMessage="">
          <nb-card-body>
            <div class="row">
              <div class="col-md-12 col-sm-12">
                <div class="row">
                  <div class="col">
                    <div class="form-group">
                      <label class="label">Lista de Fases</label>
                      <ng2-smart-table [settings]="configTabelaFase" [source]="dadosTabelaFase" (custom)="onClickTable($event)" (deleteConfirm)="onDeleteConfirm($event)">
                      </ng2-smart-table>  
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </nb-card-body>
        </nb-card>
      </nb-tab>
    </nb-tabset>
  </nb-card-body>
</nb-card>